async function scanWatch(imageFile) {
  resultsContent.innerHTML = '<div class="scanner-line" style="position: relative; animation-duration: 2s;"></div>';
  
  try {
    // Convert the image blob to base64 string
    const base64Image = await blobToBase64(imageFile);
    
    // Send as JSON instead of FormData
    const response = await fetch('https://watch-scanner.onrender.com/identify', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ image: base64Image }),
    });

    if (!response.ok) {
      const errData = await response.json();
      throw new Error(errData.error || `Server responded with status: ${response.status}`);
    }

    const data = await response.json();
    if (data.visual_matches && data.visual_matches.length > 0) {
      displayResults(data.visual_matches);
    } else {
      showError("No visual matches found.");
    }
  } catch (error) {
    console.error('Error:', error);
    showError(`Scan Failed: ${error.message}.`);
  }
}

// Add this helper function right after scanWatch
function blobToBase64(blob) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onloadend = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}
